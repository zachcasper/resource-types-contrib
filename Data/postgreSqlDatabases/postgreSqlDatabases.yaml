namespace: Radius.Data
types:
  postgreSqlDatabases:  
    description: |
      The Radius.Data/postgreSQLDatabases Resource Type deploys a PostgresSQL database. The database resource must have a connection to a Radius.Security/secrets resource with a username and password. To deploy a new PostgresSQL database, first add a secret to the application definition Bicep file. See the Radius.Security/secrets resource type documentation for details. Then add the postgreSQLDatabases resource.
      
      ```
      extension radius
      extension postgreSqlDatabases

      @description('The Radius environment ID. Typically set by the Radius CLI.')
      param environment

      resource myApplication 'Radius.Core/applications@2025-08-01-preview' = {
        name: 'myApplication'
        properties: {
          environment: environment
        }
      }

      resource database 'Radius.Data/postgreSqlDatabases@2025-08-01-preview' = {
        name: 'database'
        properties: {
          application: myApplication.id
          environment: environment
          size: 'S'
          connections: {
            credentials: {
              source: credentials.id  // Assumes the secret resource is named credentials
            }
          }
        }
      }
      ```

      To connect a container to the database, create a connection from the Container resource to the database and to the secret.

      ```
      resource frontend 'Applications.Core/containers@2023-10-01-preview' = {
        name: 'frontend'
        properties: {
          application: myApplication.id
          environment: environment
          container: {
            image: 'frontend:1.25'
            ports: {
              web: {
                containerPort: 8080
              }
            }
          }
          connections: {
            postgresql: {
              source: database.id
            }
            credentials: {
              source: credentials.id
            }
          }
        }
      }
      ```

      The connection automatically injects environment variables into the container for all properties from the database. The environment variables are named `CONNECTION_<CONNECTION-NAME>_<PROPERTY-NAME>`. In this example, the environment variables will be:
 
      - CONNECTION_POSTGRESQL_DATABASE
      - CONNECTION_POSTGRESQL_HOST
      - CONNECTION_POSTGRESQL_PORT
      - CONNECTION_CREDENTIALS_USERNAME
      - CONNECTION_CREDENTIALS_PASSWORD
    apiVersions:
      '2025-08-01-preview':
        schema: 
          type: object
          properties:
            environment:
              type: string
              description: "(Required) The Radius Environment ID. Typically set by the rad CLI. Typically value should be `environment`."
            application:
              type: string
              description: "(Optional) The Radius Application ID. `myApplication.id` for example."
            size:
              type: string
              enum: ['S', 'M', 'L']
              description: "(Optional) The relative size of the PostgreSQL database, actual size varies based on the Environment. If not specified, small is assumed."
            connections:
              type: object
              description: (Required) A connection to a Secret resource. Secret must have username and password keys.
              additionalProperties:
                type: object
                properties:
                  source:
                    type: string
                    description: (Required) The resource ID of the Secret resource.
                required: [source]
            host:
              type: string
              description: (Read Only) The host name used to connect to the database.
              readOnly: true
            port:
              type: string
              description: (Read Only) The port number used to connect to the database.
              readOnly: true
            database:
              type: string
              description: (Read Only) The name of the database.
              readOnly: true
          required: [environment, connections]